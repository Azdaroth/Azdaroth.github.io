
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 2 - Karol Galanciak - Ruby on Rails and Ember.js consultant</title>
  <meta name="author" content="Karol Galanciak">

  
  <meta name="description" content="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.">

  
  <meta name="keywords" content="Ruby on Rails, Ember.js, PostgreSQL, JavaScript, Consulting, MVP, post MVP, legacy apps">

  
  

  <meta property="og:title" value="Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 2 - Karol Galanciak - Ruby on Rails and Ember.js consultant" />
  <meta property="og:description" value="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications." />
  <meta property="og:url" value="https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2/" />
  <meta property="og:type" content="website" />
  
  <meta property="og:site_name" content="Karol Galanciak - Ruby on Rails and Ember.js consultant"/>
  <meta property="og:locale" content="en_US" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@Azdaroth">
  <meta name="twitter:creator" content="@Azdaroth">
  <meta name="twitter:title" content="Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 2 - Karol Galanciak - Ruby on Rails and Ember.js consultant">
  <meta name="twitter:url" content="">
  <meta name="twitter:description" content="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Karol Galanciak - Ruby on Rails and Ember.js consultant" type="application/atom+xml">
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type":"WebPage",
        "@id": "https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2"
      },
      "headline": "Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 2 - Karol Galanciak - Ruby on Rails and Ember.js consultant",
        "image": {
        "@type": "ImageObject",
        "url": "",
        "height": 640,
        "width": 1024
      },
      "datePublished": "2016-06-12",
      "dateModified": "2019-05-03",
      "author": {
        "@type": "Person",
        "name": "Karol Galanciak"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Karol Galanciak",
        "logo": {
          "@type": "ImageObject",
          "url": "https://karolgalanciak.com/images/me_formal.jpg",
          "width": 600,
          "height": 60
        }
      },
      "description": "Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.",
      "keywords": "Ruby on Rails, Ember.js, PostgreSQL, JavaScript, Consulting, MVP, post MVP, legacy apps"
    }
  </script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42570582-1', 'auto');
    ga('send', 'pageview');
    ga('set', 'anonymizeIp', true);
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Karol Galanciak - Ruby on Rails and Ember.js consultant</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:karolgalanciak.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">About Me</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/test-driven-ember">Test-Driven Ember Book</a></li>
  <li><a href="/presentations">Presentations</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="/open-source">Open Source</a></li>
  <li><a href="/privacy-policy">Privacy Policy</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-06-12T22:45:00+02:00" pubdate data-updated="true">Jun 12<span>th</span>, 2016</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In the previous <a href="https://karolgalanciak.com/blog/2016/06/05/scaling-up-rails-applications-with-postgresql-table-partitioning-part-1/" target="_blank">blog post</a> we learned some basics about <strong>table partitioning</strong>: how it works and what kind of problems it solves. So far we&#8217;ve been discussing mostly basic concepts with raw <strong>SQL</strong> examples. But the essential question in our case would be: how to make it work inside <strong>Rails application</strong> then? Let&#8217;s see what we can do about it.</p>




<!--more-->




<h2>Partitioning tables with <code>partitioned</code> gem</h2>




<p>It turns out there&#8217;s no built-in support for table partitioning in ActiveRecord. Fortunately, there&#8217;s a gem that makes it pretty straight-forward to apply this concept to your models: <a href="https://github.com/fiksu/partitioned" target="_blank">partitioned</a>. Not only does it have several strategies for partitioning (e.g. by foreign key or by yearly / weekly / monthly and you can easily create custom ones by subclassing base class and defining proper methods) making it easy to perform <strong>CRUD</strong> operations when dealing with multiple tables, but it also provides some methods to create and destroy infrastructure (separate schema for partitioned tables) and some helper methods for generating tables based on partitioning criteria, even with indexes and constraints! Let&#8217;s get back to example from previous the blog post with orders. Firstly, add <code>partitioned</code> gem to the Gemfile. Unfortunately, there are some issues with compatibility with Rails 4.2 at the time I was experimenting with it, so it might be necessary to use some forks. The following combination should work with Rails 4.2.6:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'activerecord-redshift-adapter',  git: "git@github.com:arp/activerecord-redshift-adapter.git", branch: "rails4-compatibility"
</span><span class='line'>gem 'partitioned', git: "git@github.com:dkhofer/partitioned.git", branch: "rails-4-2"</span></code></pre></td></tr></table></div></figure>




<p>and of course run <code>bundle install</code>. Now we can generate model:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails generate model Order</span></code></pre></td></tr></table></div></figure>




<p>Firstly, let&#8217;s set up the partitioned Order model. To handle partitioning strategy for separate tables for every year based on <code>created_at</code> column, we could define the following base class:</p>




<figure class='code'><figcaption><span>app/models/partitioned_by_created_at_yearly.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PartitionedByCreatedAtYearly</span> <span class="o">&lt;</span> <span class="ss">Partitioned</span><span class="p">:</span><span class="ss">:ByYearlyTimeField</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">abstract_class</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">partition_time_field</span>
</span><span class='line'>    <span class="ss">:created_at</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">partitioned</span> <span class="k">do</span> <span class="o">|</span><span class="n">partition</span><span class="o">|</span>
</span><span class='line'>    <span class="n">partition</span><span class="o">.</span><span class="n">index</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>This class inherits from <code>Partitioned::ByYearlyTimeField</code> to handle exactly the strategy we need for orders. We set this class to be an abstract one to make it clear it&#8217;s not related to any table in the database. We also need to provide <code>partition_time_field</code>, in our case it&#8217;s <code>created_at</code> column. In <code>partitioned</code> block we can define some extra constraints and indexes that will be used when creating children tables. The next thing would be to make it a parent class for <code>Order</code> model:</p>




<figure class='code'><figcaption><span>app/models/order.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">PartitionedByCreatedAtYearly</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<h2>Creating migration for partitioned tables</h2>




<p>Let&#8217;s get back to our migration. What we want to do is to create <code>orders</code> table, a schema for children partitioned tables of orders and the tables themselves for the next several years. We could do it the following way:</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">class</span> <span class="n">CreateOrders</span> <span class="o">&lt;</span> <span class="n">ActiveRecord</span><span class="p">::</span><span class="n">Migration</span>
</span><span class='line'>  <span class="n">def</span> <span class="n">up</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="p">:</span><span class="n">orders</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">t</span><span class="p">.</span><span class="n">timestamps</span> <span class="k">null</span><span class="p">:</span> <span class="k">false</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">Order</span><span class="p">.</span><span class="n">create_infrastructure</span>
</span><span class='line'>    <span class="n">dates</span> <span class="o">=</span> <span class="k">Order</span><span class="p">.</span><span class="n">partition_generate_range</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="n">today</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="n">today</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="k">year</span><span class="p">)</span>
</span><span class='line'>    <span class="k">Order</span><span class="p">.</span><span class="n">create_new_partition_tables</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">def</span> <span class="n">down</span>
</span><span class='line'>    <span class="k">Order</span><span class="p">.</span><span class="n">delete_infrastructure</span>
</span><span class='line'>    <span class="n">drop_table</span> <span class="p">:</span><span class="n">orders</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>The gem also provides excellent helper method <code>partition_generate_range</code> to help with setting up new partition tables. That way we will generate tables handling orders from 2016 to 2021. Now you can simply run <code>rake db:migrate</code>.</p>




<h2>CRUD operations on partitioned tables</h2>




<p>So far we&#8217;ve managed to set up the database for handling table partitioning. But the essential question is: can our app handle management of these tables? Will it insert / update / delete records to and from proper tables? Let&#8217;s play with some operations to find out:</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="k">create</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">11</span><span class="p">.</span><span class="mi">7</span><span class="n">ms</span><span class="p">)</span>  <span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2016&quot;</span> <span class="p">(</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;updated_at&quot;</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="err">$</span><span class="mi">2</span><span class="p">)</span> <span class="n">RETURNING</span> <span class="ss">&quot;id&quot;</span>  <span class="p">[[</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2016-06-03 17:21:36.221268&quot;</span><span class="p">],</span> <span class="p">[</span><span class="ss">&quot;updated_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2016-06-03 17:21:36.221268&quot;</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">5</span><span class="p">.</span><span class="mi">9</span><span class="n">ms</span><span class="p">)</span>  <span class="k">COMMIT</span>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="k">create</span><span class="p">(</span><span class="n">created_at</span><span class="p">:</span> <span class="mi">1</span><span class="p">.</span><span class="k">year</span><span class="p">.</span><span class="n">from_now</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="n">ms</span><span class="p">)</span>  <span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="p">(</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;updated_at&quot;</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="err">$</span><span class="mi">2</span><span class="p">)</span> <span class="n">RETURNING</span> <span class="ss">&quot;id&quot;</span>  <span class="p">[[</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2017-06-03 17:25:05.413114&quot;</span><span class="p">],</span> <span class="p">[</span><span class="ss">&quot;updated_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2016-06-03 17:25:05.414208&quot;</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">121</span><span class="p">.</span><span class="mi">4</span><span class="n">ms</span><span class="p">)</span>  <span class="k">COMMIT</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2017-06-03 17:25:05&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:25:05&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="k">create</span><span class="p">(</span><span class="n">created_at</span><span class="p">:</span> <span class="mi">2</span><span class="p">.</span><span class="n">years</span><span class="p">.</span><span class="n">from_now</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2018&quot;</span> <span class="p">(</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;updated_at&quot;</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="err">$</span><span class="mi">2</span><span class="p">)</span> <span class="n">RETURNING</span> <span class="ss">&quot;id&quot;</span>  <span class="p">[[</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2018-06-03 17:25:11.634532&quot;</span><span class="p">],</span> <span class="p">[</span><span class="ss">&quot;updated_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2016-06-03 17:25:11.635389&quot;</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">COMMIT</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2018-06-03 17:25:11&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:25:11&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="k">all</span>
</span><span class='line'>  <span class="k">Order</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span> <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;orders&quot;</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="o">#&lt;</span><span class="n">ActiveRecord</span><span class="p">::</span><span class="n">Relation</span> <span class="p">[</span><span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:21:36&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:21:36&quot;</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2017-06-03 17:25:05&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:25:05&quot;</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2018-06-03 17:25:11&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:25:11&quot;</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="k">all</span><span class="p">.</span><span class="k">count</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="ss">&quot;orders&quot;</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="k">Order</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span>  <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;orders&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="k">LIMIT</span> <span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:21:36&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:21:36&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="n">from_partition</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">find</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="k">Order</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span>  <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="ss">&quot;orders&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="k">LIMIT</span> <span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="o">#&lt;</span><span class="k">Order</span> <span class="n">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">created_at</span><span class="p">:</span> <span class="ss">&quot;2017-06-03 17:25:05&quot;</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">:</span> <span class="ss">&quot;2016-06-03 17:25:05&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'> <span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="n">from_partition</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">find</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="k">update</span><span class="o">!</span><span class="p">(</span><span class="n">updated_at</span><span class="p">:</span> <span class="mi">5</span><span class="p">.</span><span class="n">years</span><span class="p">.</span><span class="n">from_now</span><span class="p">)</span>
</span><span class='line'>  <span class="k">Order</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span>  <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="ss">&quot;orders&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="k">LIMIT</span> <span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>  <span class="k">UPDATE</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="k">SET</span> <span class="ss">&quot;updated_at&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="ss">&quot;created_at&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">2</span> <span class="k">WHERE</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="mi">2</span>  <span class="p">[[</span><span class="ss">&quot;updated_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2021-06-03 17:29:07.077931&quot;</span><span class="p">],</span> <span class="p">[</span><span class="ss">&quot;created_at&quot;</span><span class="p">,</span> <span class="ss">&quot;2017-06-03 17:25:05.413114&quot;</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">7</span><span class="n">ms</span><span class="p">)</span>  <span class="k">COMMIT</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="n">from_partition</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">find</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="k">destroy</span>
</span><span class='line'>  <span class="k">Order</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span>  <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2018&quot;</span> <span class="ss">&quot;orders&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="k">LIMIT</span> <span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">DELETE</span> <span class="k">FROM</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2018&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2018&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">7</span><span class="n">ms</span><span class="p">)</span>  <span class="k">COMMIT</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="n">from_partition</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">update_all</span><span class="p">(</span><span class="n">updated_at</span><span class="p">:</span> <span class="n">Time</span><span class="p">.</span><span class="k">zone</span><span class="p">.</span><span class="n">now</span><span class="p">)</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">6</span><span class="n">ms</span><span class="p">)</span>  <span class="k">UPDATE</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="ss">&quot;orders&quot;</span> <span class="k">SET</span> <span class="ss">&quot;updated_at&quot;</span> <span class="o">=</span> <span class="s1">&#39;2016-06-03 17:30:59.926682&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="k">Order</span><span class="p">.</span><span class="n">from_partition</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="n">destroy_all</span>
</span><span class='line'>  <span class="k">Order</span> <span class="k">Load</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="k">SELECT</span> <span class="ss">&quot;orders&quot;</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="ss">&quot;orders&quot;</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">SQL</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>  <span class="k">DELETE</span> <span class="k">FROM</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span> <span class="k">WHERE</span> <span class="ss">&quot;orders_partitions&quot;</span><span class="p">.</span><span class="ss">&quot;p2017&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span>  <span class="p">[[</span><span class="ss">&quot;id&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">6</span><span class="n">ms</span><span class="p">)</span>  <span class="k">COMMIT</span>
</span></code></pre></td></tr></table></div></figure>




<p>Awesome! Looks like all the CRUD operations work without any problems! We even have extremely helpful query method <code>from_partition</code> to scope queries to the specific child table.</p>




<h2>Wrapping up</h2>




<p>Table partitioning might a great solution to solve database performance issues. Even though it&#8217;s not supported out-of-the-box by Rails, you can easily integrate it with your app thanks to <a href="https://github.com/fiksu/partitioned" target="_blank">partitioned</a> gem.</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Karol Galanciak</span></span>

      








  


<time datetime="2016-06-12T22:45:00+02:00" pubdate data-updated="true">Jun 12<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/postgresql/'>PostgreSQL</a>, <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/ruby-on-rails/'>Ruby on Rails</a>, <a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/databases/'>databases</a>, <a class='category' href='/blog/categories/performance/'>performance</a>, <a class='category' href='/blog/categories/scaling/'>scaling</a>
  
</span>


    </p>
    <div class="meta top-line">
      <div class="post-subscription">
  <div id="mc_embed_signup">
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">Do you want to take your developer skills to the next level? Subscribe to my newsletter and never miss another blog post!</label>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_62804f1b69c60e0c7966cddd6_7c71fb81df" tabindex="-1" value=""></div>
      <div class="clear">
      <a href="http://eepurl.com/duztq5" target="_blank" id="mc-embedded-subscribe" class="button">Yes, I want to be a better developer!</a>
    </div>
  </div>
</div>

    </div>
    <div class="top-line">
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2/" data-via="Azdaroth" data-counturl="https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </div>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/06/05/scaling-up-rails-applications-with-postgresql-table-partitioning-part-1/" title="Previous Post: Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 1">&laquo; Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 1</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/07/10/scaling-up-rails-applications-with-postgresql-table-partitioning-part-3/" title="Next Post: Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 3">Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 3 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <img class="left" src="/images/me_formal.jpg" title="me:)" alt="Karol Galanciak - photo">
  <p>Hi, my name is Karol Galanciak, I'm a technical polyglot and domain expert in vacation rental industry, taking it to the next level as CTO of <a href="https://www.bookingsync.com">BookingSync</a></p>

  <p>I specialize in building APIs, enterprise integration using message queues and distributed streaming, microservices architecture and working with legacy applications.</p>

  <p id="email-me"></p>
</section>

<script type="text/javascript">
  (function(d, id, lhs, rhs) {
    d.getElementById(id).innerHTML = "You can reach me at <a rel='nofollow' href='mailto:" + lhs + "@" + rhs + "'>" + lhs + "@" + rhs + "</a>";
  })(window.document, 'email-me', 'karol.galanciak', 'gmail.com');
</script>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/04/07/messages-on-rails-part-2-kafka/">Messages on Rails Part 2: Kafka</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/24/messages-on-rails-part-1-introduction-to-kafka-and-rabbitmq/">Messages on Rails Part 1 - Introduction to Kafka and RabbitMQ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/27/how-to-tell-the-difference-between-a-default-and-provided-value-for-optional-arguments-in-ruby/">How to Tell the Difference Between a Default and a Provided Value for Optional Arguments in Ruby?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/12/16/inheritance-and-define-method-how-to-make-them-work-together/">Inheritance and Define_method - How to Make Them Work Together</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/09/30/the-problems-with-validating-activerecord-models-and-why-state-validation-is-a-bad-idea/">The Problems With Validating ActiveRecord Models and Why State Validation Is a Bad Idea</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Azdaroth">@Azdaroth</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Azdaroth',
            count: 6,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
   <h1>Twitter</h1>
   <a class="twitter-timeline" href="https://twitter.com/Azdaroth" data-widget-id="357234540634329088">Tweets by @Azdaroth</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Karol Galanciak -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'karolgalanciak';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2/';
        var disqus_url = 'https://karolgalanciak.com/blog/2016/06/12/scaling-up-rails-applications-with-postgresql-table-partitioning-part-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
