
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>When validation is not enough: PostgreSQL triggers for data integrity - Karol Galanciak - Ruby on Rails and Ember.js consultant</title>
  <meta name="author" content="Karol Galanciak">

  
  <meta name="description" content="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.">

  
  <meta name="keywords" content="Ruby on Rails, Ember.js, PostgreSQL, JavaScript, Consulting, MVP, post MVP, legacy apps">

  
  

  <meta property="og:title" value="When validation is not enough: PostgreSQL triggers for data integrity - Karol Galanciak - Ruby on Rails and Ember.js consultant" />
  <meta property="og:description" value="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications." />
  <meta property="og:url" value="https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity/" />
  <meta property="og:type" content="website" />
  
  <meta property="og:site_name" content="Karol Galanciak - Ruby on Rails and Ember.js consultant"/>
  <meta property="og:locale" content="en_US" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@Azdaroth">
  <meta name="twitter:creator" content="@Azdaroth">
  <meta name="twitter:title" content="When validation is not enough: PostgreSQL triggers for data integrity - Karol Galanciak - Ruby on Rails and Ember.js consultant">
  <meta name="twitter:url" content="">
  <meta name="twitter:description" content="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Karol Galanciak - Ruby on Rails and Ember.js consultant" type="application/atom+xml">
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type":"WebPage",
        "@id": "https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity"
      },
      "headline": "When validation is not enough: PostgreSQL triggers for data integrity - Karol Galanciak - Ruby on Rails and Ember.js consultant",
        "image": {
        "@type": "ImageObject",
        "url": "",
        "height": 640,
        "width": 1024
      },
      "datePublished": "2016-05-06",
      "dateModified": "2018-09-29",
      "author": {
        "@type": "Person",
        "name": "Karol Galanciak"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Karol Galanciak",
        "logo": {
          "@type": "ImageObject",
          "url": "https://karolgalanciak.com/images/me_formal.jpg",
          "width": 600,
          "height": 60
        }
      },
      "description": "Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.",
      "keywords": "Ruby on Rails, Ember.js, PostgreSQL, JavaScript, Consulting, MVP, post MVP, legacy apps"
    }
  </script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42570582-1', 'auto');
    ga('send', 'pageview');
    ga('set', 'anonymizeIp', true);
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Karol Galanciak - Ruby on Rails and Ember.js consultant</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:karolgalanciak.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">About Me</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/test-driven-ember">Test-Driven Ember Book</a></li>
  <li><a href="/presentations">Presentations</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="/open-source">Open Source</a></li>
  <li><a href="/privacy-policy">Privacy Policy</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">When Validation Is Not Enough: PostgreSQL Triggers for Data Integrity</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-05-06T19:45:00+02:00" pubdate data-updated="true">May 6<span>th</span>, 2016</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Is <strong>validation</strong> in your models or form objects enough to ensure <strong>integrity of the data</strong>? Well, seems like you can&#8217;t really persist a record when the data is <strong>not valid</strong> unless you intentionally try to bypass validation using <code>save: false</code> option when calling <code>save</code> or using <code>update_column</code>. What about <strong>uniqueness validation</strong>?
A classic example would be a unique <code>email</code> per user. To make sure the email is truly unique we could add a unique index in database - not only would it prevent saving non-unique users when <strong>bypassing validation</strong>, but also it would raise extra error when 2 <strong>concurrent requests</strong> would attempt to save user with the same email. However, some validations are more complex that ensuring  a value is unique and index won&#8217;t really help much. Fortunately, PostgreSQL is powerful enough to provide a perfect solution to such problem. Time to meet your new friend: <strong>PostgreSQL triggers</strong>.</p>




<!--more-->




<h2>Anatomy of PostgreSQL triggers and procedures</h2>




<p>PostgreSQL trigger is like a callback: it&#8217;s a function that is called on specific event: <code>before</code> or <code>after</code> <code>insert</code>, <code>update</code>, <code>delete</code> or <code>truncate</code> in case of tables and views and for views you can also run a function <code>instead of</code> those events. Triggers can be run either <code>for each row</code> (tables only) and <code>for each statement</code> (both tables and views). The difference between them is quite simple: <code>for each row</code> is run for every modified row and <code>for each statement</code> is run only once per statement. The important thing to keep in mind regarding <code>for each row</code> is that you have a reference to the row being modified, which will be essential in upcoming example.</p>




<p>By running <code>\h CREATE TRIGGER;</code> from <strong>psql</strong> we can get a generalized syntax for creating triggers:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Command:     CREATE TRIGGER
</span><span class='line'>Description: define a new trigger
</span><span class='line'>Syntax:
</span><span class='line'>CREATE [ CONSTRAINT ] TRIGGER name { BEFORE | AFTER | INSTEAD OF } { event [ OR ... ] }
</span><span class='line'>    ON table_name
</span><span class='line'>    [ FROM referenced_table_name ]
</span><span class='line'>    [ NOT DEFERRABLE | [ DEFERRABLE ] { INITIALLY IMMEDIATE | INITIALLY DEFERRED } ]
</span><span class='line'>    [ FOR [ EACH ] { ROW | STATEMENT } ]
</span><span class='line'>    [ WHEN ( condition ) ]
</span><span class='line'>    EXECUTE PROCEDURE function_name ( arguments )
</span><span class='line'>
</span><span class='line'>where event can be one of:
</span><span class='line'>
</span><span class='line'>    INSERT
</span><span class='line'>    UPDATE [ OF column_name [, ... ] ]
</span><span class='line'>    DELETE
</span><span class='line'>    TRUNCATE</span></code></pre></td></tr></table></div></figure>




<p>You can also add a <b>condition</b> for running <strong>triggers</strong> and timing option, which I&#8217;m not going to discuss in greater details, you can find more about them in official <a href="http://www.postgresql.org/docs/9.5/static/sql-createtrigger.html" target="_blank">docs</a>.</p>




<p>What about <code>function_name</code>? It&#8217;s a user-defined function returning <code>trigger</code>. Here&#8217;s a dummy example to give an idea about the syntax for defining functions:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE FUNCTION dummy() RETURNS trigger AS $$
</span><span class='line'>DECLARE
</span><span class='line'>    some_integer_variable int;
</span><span class='line'>BEGIN
</span><span class='line'>    some_integer_variable := 1;
</span><span class='line'>    NEW.counter := some_integer_variable;
</span><span class='line'>    RETURN NEW;
</span><span class='line'>END;
</span><span class='line'>$$ language plpgsql;</span></code></pre></td></tr></table></div></figure>




<p>We started with defining <code>dummy</code> function taking no arguments returning type of <strong>trigger</strong>. Next, we have a <code>DECLARE</code> block where we declare temporary variables, in our case it&#8217;s <code>some_integer_variable</code> of type <code>int</code>. Within <code>BEGIN / END</code> block we define the actual function body: we assign a dummy value to <code>some_integer_variable</code> variable using <code>:=</code> operator and then we do some assignment using implicit <code>NEW</code> variable which is basically a row referenced by given statement. This variable is available only when running a trigger <code>for each row</code>, otherwise it will return <code>NULL</code>. Any trigger has to return either a <strong>row</strong> or <code>NULL</code> - in this example we return <code>NEW</code> row. At the end we have a declaration of writing function in <code>plpgsql</code> language.</p>




<p>Let&#8217;s take a look at some real world code to see triggers in action.</p>




<h2>Using triggers for data integrity</h2>




<p>A good example where we could use a trigger for more complex validation could be a calendar event: we need to ensure that no other event exists between some <code>begins_at</code> time and <code>finishes_at</code> time. We should also scope it only to a given calendar and exclude id of event being updated - when creating new events it wouldn&#8217;t matter, but without excluding id we wouldn&#8217;t be able to update any event. So what we actually want to achieve is to create a trigger that will be run <code>before insert or update</code> on <b>events</b> table <code>for each row</code>.</p>




<p>Let&#8217;s start with generating <code>Calendar</code> model and <code>Event</code> model with reference to <code>calendar</code> and <code>begins_at</code> and <code>finishes_at</code> attributes:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails generate model Calendar
</span><span class='line'>rails generate model Event calendar_id:integer begins_at:datetime finishes_at:datetime</span></code></pre></td></tr></table></div></figure>




<p>and also generate extra migration adding <strong>trigger</strong> and <strong>procedure</strong> ensuring that only one event can be created for given period of time for a calendar:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails generate migration add_validation_trigger_for_events_availability</span></code></pre></td></tr></table></div></figure>




<p>add the SQL code :</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddValidationTriggerForEventsAvailability</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">execute</span> <span class="o">&lt;&lt;-</span><span class="no">CODE</span>
</span><span class='line'><span class="sh">      CREATE FUNCTION validate_event_availability() returns trigger as $$</span>
</span><span class='line'><span class="sh">      DECLARE</span>
</span><span class='line'><span class="sh">        events_count int;</span>
</span><span class='line'><span class="sh">      BEGIN</span>
</span><span class='line'><span class="sh">        events_count := (SELECT COUNT(*) FROM events WHERE (</span>
</span><span class='line'><span class="sh">          events.calendar_id = NEW.calendar_id AND events.begins_at &lt; NEW.finishes_at AND events.finishes_at &gt; NEW.begins_at AND events.id != NEW.id</span>
</span><span class='line'><span class="sh">        ));</span>
</span><span class='line'><span class="sh">        IF (events_count != 0) THEN</span>
</span><span class='line'><span class="sh">          RAISE EXCEPTION &#39;Period between % and % is already taken&#39;, NEW.begins_at, NEW.finishes_at;</span>
</span><span class='line'><span class="sh">        END IF;</span>
</span><span class='line'><span class="sh">        RETURN NEW;</span>
</span><span class='line'><span class="sh">      END;</span>
</span><span class='line'><span class="sh">      $$ language plpgsql;</span>
</span><span class='line'>
</span><span class='line'><span class="sh">      CREATE TRIGGER validate_event_availability_trigger BEFORE INSERT OR UPDATE ON events</span>
</span><span class='line'><span class="sh">      FOR EACH ROW EXECUTE PROCEDURE validate_event_availability();</span>
</span><span class='line'><span class="no">    CODE</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>Our <code>validate_event_availability</code> function performs query to count all events that are between given time period for specified calendar excluding own id (so that the row being updated is not considered here, which would prevent updating any event). If any other event is found, the exception is raised with an error message - <code>%</code> characters are used for interpolation of <code>begins_at</code> and <code>finishes_at</code> attributes. If no other event is found, we simply return the row.</p>




<p>We want to define a trigger running this function before creating any new event or updating existing ones, so we need to run it <code>BEFORE INSERT OR UPDATE</code> <code>FOR EACH ROW</code>.</p>




<p>It might be a good idea to switch also to <code>:sql</code> schema format - the standard <code>:ruby</code> format can&#8217;t handle triggers at this point. Add this line in <code>config/application.rb</code>:</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/application.rb</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">active_record</span><span class="o">.</span><span class="n">schema_format</span> <span class="o">=</span> <span class="ss">:sql</span>
</span></code></pre></td></tr></table></div></figure>




<p>Now we can run migrations:</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>




<p>After changing the schema format, new <code>structure.sql</code> file should be created. It&#8217;s not going to look that nice like <code>schema.rb</code>, but at least it contains all the details. Let&#8217;s try creating some events from <code>rails console</code>:</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">calendar</span> <span class="o">=</span> <span class="no">Calendar</span><span class="o">.</span><span class="n">create</span>
</span><span class='line'><span class="n">begins_at</span> <span class="o">=</span> <span class="s2">&quot;2016-05-02 12:00:00&quot;</span>
</span><span class='line'><span class="n">finishes_at</span> <span class="o">=</span>  <span class="s2">&quot;2016-05-02 16:00:00&quot;</span>
</span><span class='line'><span class="no">Event</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">calendar_id</span><span class="p">:</span> <span class="n">calendar</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">begins_at</span><span class="p">:</span> <span class="n">begins_at</span><span class="p">,</span> <span class="n">finishes_at</span><span class="p">:</span> <span class="n">finishes_at</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<p>Creating first event obviously works, but what&#8217;s going to happen when we try to create an event with exactly the same dates?</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Event</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">calendar_id</span><span class="p">:</span> <span class="n">calendar</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">begins_at</span><span class="p">:</span> <span class="n">begins_at</span><span class="p">,</span> <span class="n">finishes_at</span><span class="p">:</span> <span class="n">finishes_at</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:StatementInvalid</span><span class="p">:</span> <span class="ss">PG</span><span class="p">:</span><span class="ss">:RaiseException</span><span class="p">:</span> <span class="ss">ERROR</span><span class="p">:</span>  <span class="no">Period</span> <span class="n">between</span> <span class="mi">2016</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mo">02</span> <span class="mi">12</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="ow">and</span> <span class="mi">2016</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mo">02</span> <span class="mi">16</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">is</span> <span class="n">already</span> <span class="n">taken</span>
</span></code></pre></td></tr></table></div></figure>




<p>Awesome (haha, doesn&#8217;t happen that often to be happy when an error occurs ;)), that&#8217;s exactly what we wanted to achieve - the trigger keeps our data safe making sure that we won&#8217;t have any duplicated events or events covering the same time period. The last thing we should do is to mimic such validation and add it to form object or model for better user experience, but it&#8217;s beyond the scope of this article. It&#8217;s going to duplicate some logic between the code in the application and the database, but in this case there&#8217;s no way to <strong>DRY</strong> it up.</p>




<h2>Wrapping up</h2>




<p>PostgreSQL triggers and procedures are not something that you will often want to use in Rails applications, but sometimes there&#8217;s no other solution, especially when you have more complex rules for data integrity. In such cases, triggers and procedures are the right tool for the job.</p>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Karol Galanciak</span></span>

      








  


<time datetime="2016-05-06T19:45:00+02:00" pubdate data-updated="true">May 6<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/activerecord/'>ActiveRecord</a>, <a class='category' href='/blog/categories/database/'>Database</a>, <a class='category' href='/blog/categories/patterns/'>Patterns</a>, <a class='category' href='/blog/categories/postgresql/'>PostgreSQL</a>, <a class='category' href='/blog/categories/quick-tips/'>Quick Tips</a>, <a class='category' href='/blog/categories/triggers/'>Triggers</a>
  
</span>


    </p>
    <div class="meta top-line">
      <div class="post-subscription">
  <div id="mc_embed_signup">
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">Do you want to take your developer skills to the next level? Subscribe to my newsletter and never miss another blog post!</label>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_62804f1b69c60e0c7966cddd6_7c71fb81df" tabindex="-1" value=""></div>
      <div class="clear">
      <a href="http://eepurl.com/duztq5" target="_blank" id="mc-embedded-subscribe" class="button">Yes, I want to be a better developer!</a>
    </div>
  </div>
</div>

    </div>
    <div class="top-line">
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity/" data-via="Azdaroth" data-counturl="https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </div>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/04/24/security-on-rails-hacking-sessions-with-insecure-secret-key-base/" title="Previous Post: Security On Rails: Hacking Sessions With Insecure Secret Key Base">&laquo; Security On Rails: Hacking Sessions With Insecure Secret Key Base</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/06/05/scaling-up-rails-applications-with-postgresql-table-partitioning-part-1/" title="Next Post: Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 1">Scaling Up Rails Applications With PostgreSQL Table Partitioning - Part 1 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <img class="left" src="/images/me_formal.jpg" title="me:)" alt="Karol Galanciak - photo">
  <p>Hi, my name is Karol Galanciak, I'm a technical polyglot and domain expert in vacation rental industry, taking it to the next level as CTO of <a href="https://www.bookingsync.com">BookingSync</a></p>

  <p>I specialize in building APIs, enterprise integration using message queues and distributed streaming, microservices architecture and working with legacy applications.</p>

  <p id="email-me"></p>
</section>

<script type="text/javascript">
  (function(d, id, lhs, rhs) {
    d.getElementById(id).innerHTML = "You can reach me at <a rel='nofollow' href='mailto:" + lhs + "@" + rhs + "'>" + lhs + "@" + rhs + "</a>";
  })(window.document, 'email-me', 'karol.galanciak', 'gmail.com');
</script>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/09/30/the-problems-with-validating-activerecord-models-and-why-state-validation-is-a-bad-idea/">The Problems With Validating ActiveRecord Models and Why State Validation Is a Bad Idea</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/19/indexes-on-rails-how-to-make-the-most-of-your-postgres-database/">Indexes on Rails: How to Make the Most of Your Postgres Database</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/07/29/trolling-in-ruby-implementing-javascript-like-maths-with-implicit-conversion-hijacking/">Trolling in Ruby - Implementing JavaScript-like Maths With Implicit Conversion Hijacking</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/06/24/rails-and-conditional-validations-in-models/">Rails and Conditional Validations in Models</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/05/27/the-case-for-before-validation-callback-complex-state-normalization/">The Case for Before_validation Callback: Complex State Normalization</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Azdaroth">@Azdaroth</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Azdaroth',
            count: 6,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
   <h1>Twitter</h1>
   <a class="twitter-timeline" href="https://twitter.com/Azdaroth" data-widget-id="357234540634329088">Tweets by @Azdaroth</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Karol Galanciak -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'karolgalanciak';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity/';
        var disqus_url = 'https://karolgalanciak.com/blog/2016/05/06/when-validation-is-not-enough-postgresql-triggers-for-data-integrity/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
