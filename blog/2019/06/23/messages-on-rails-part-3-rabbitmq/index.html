
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Messages on Rails Part 3: RabbitMQ - Karol Galanciak - Ruby on Rails and Ember.js consultant</title>
  <meta name="author" content="Karol Galanciak">

  
  <meta name="description" content="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.">

  
  <meta name="keywords" content="Ruby on Rails, Ember.js, PostgreSQL, JavaScript, Consulting, MVP, post MVP, legacy apps">

  
  

  <meta property="og:title" value="Messages on Rails Part 3: RabbitMQ - Karol Galanciak - Ruby on Rails and Ember.js consultant" />
  <meta property="og:description" value="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications." />
  <meta property="og:url" value="https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq/" />
  <meta property="og:type" content="website" />
  
  <meta property="og:site_name" content="Karol Galanciak - Ruby on Rails and Ember.js consultant"/>
  <meta property="og:locale" content="en_US" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@Azdaroth">
  <meta name="twitter:creator" content="@Azdaroth">
  <meta name="twitter:title" content="Messages on Rails Part 3: RabbitMQ - Karol Galanciak - Ruby on Rails and Ember.js consultant">
  <meta name="twitter:url" content="">
  <meta name="twitter:description" content="Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Karol Galanciak - Ruby on Rails and Ember.js consultant" type="application/atom+xml">
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type":"WebPage",
        "@id": "https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq"
      },
      "headline": "Messages on Rails Part 3: RabbitMQ - Karol Galanciak - Ruby on Rails and Ember.js consultant",
        "image": {
        "@type": "ImageObject",
        "url": "",
        "height": 640,
        "width": 1024
      },
      "datePublished": "2019-06-23",
      "dateModified": "2019-06-23",
      "author": {
        "@type": "Person",
        "name": "Karol Galanciak"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Karol Galanciak",
        "logo": {
          "@type": "ImageObject",
          "url": "https://karolgalanciak.com/images/me_formal.jpg",
          "width": 600,
          "height": 60
        }
      },
      "description": "Karol Galanciak - Ruby on Rails and Ember.js consultant, building ambitious and high performant web applications.",
      "keywords": "Ruby on Rails, Ember.js, PostgreSQL, JavaScript, Consulting, MVP, post MVP, legacy apps"
    }
  </script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42570582-1', 'auto');
    ga('send', 'pageview');
    ga('set', 'anonymizeIp', true);
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Karol Galanciak - Ruby on Rails and Ember.js consultant</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:karolgalanciak.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">About Me</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/test-driven-ember">Test-Driven Ember Book</a></li>
  <li><a href="/presentations">Presentations</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="/open-source">Open Source</a></li>
  <li><a href="/privacy-policy">Privacy Policy</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Messages on Rails Part 3: RabbitMQ</h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-06-23T18:00:00+02:00" pubdate data-updated="true">Jun 23<span>rd</span>, 2019</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In the <a href="https://karolgalanciak.com/blog/2019/02/24/messages-on-rails-part-1-introduction-to-kafka-and-rabbitmq/">first part</a> of this series, we were exploring some potential options for <strong>communication between services</strong> &ndash; what their advantages and disadvantages are, why <strong>HTTP API</strong> is not necessarily the best possible choice and suggesting that <strong>asynchronous messaging</strong> might be a better solution, using, e.g. <strong>RabbitMQ</strong> and <strong>Kafka</strong>. We&rsquo;ve already covered <strong>Kafka</strong> in the <a href="https://karolgalanciak.com/blog/2019/04/07/messages-on-rails-part-2-kafka/">part 2</a>, now it&rsquo;s the time for <strong>RabbitMQ</strong>.</p>

<!--more-->


<h2>What is RabbitMQ, and how does it work?</h2>

<p>RabbitMQ is a general purpose message broker supporting multiple protocols, yet, we are going to focus mostly on AMQP, which is the one that is the most typically used. It implements a smart broker/dumb consumer model. Unlike Kafka, it means that the broker is responsible for delivering messages to the right place. Also, the <code>queue</code> in Rabbit is what you would naturally consider being a queue &ndash; it&rsquo;s not database-like storage as Kafka topics are.</p>

<p>So what does publishing and consuming a message actually mean?</p>

<p>In the first step, a <code>producer</code> publishes a <code>message</code> &ndash; this can be a JSON message or whatever else that could be sent. This message is delivered to a <code>queue</code>, from which <code>consumers</code> can read it and process it. After the message is consumed, it&rsquo;s gone from the queue.</p>

<p>If this sounds to you like Redis and Sidekiq, you would be quite right. Actually, Redis could also be used as a message queue for communication between apps, although that might not be necessarily the best idea as being a message queue is not its primary purpose.</p>

<p>Why is RabbitMQ is so unique though, and what can it do that Redis or even Kafka can&rsquo;t do?</p>

<p>One of the key characteristics of RabbitMQ is that producers don&rsquo;t push messages directly to the queues. Instead, producers send messages to another layer called <code>exchanges</code>. This has quite profound consequences on the way RabbitMQ can be used and the features it offers:</p>

<ul>
<li>Producers don&rsquo;t need to be aware of all the queues where the message should be delivered, which means excellent decoupling between producers and consumers and ease of use</li>
<li>Without exchanges, it would not be possible to easily implement a publish-subscribe pattern where multiple consumers need to process a given message. Instead, you would have pretty much something like in Sidekiq &ndash; when the message is pushed to the queue, the workers compete for it, and it gets processed only once, there is no case of multiple workers handling the same message. However, competing consumers pattern is still possible in RabbitMQ (we will see it later but rather as something to avoid in that particular case).</li>
<li>Having extra layer in-between allows flexible routing and the implementation of some rules telling how and under what conditions consumers want to have messages delivered.</li>
</ul>


<p>In general, we could visualize the flow in RabbitMQ in the following way:</p>

<p class="img-center-wrapper">
  <img class="img-center" src="/images/messages_on_rails_part_3/rabbitmq_generalization.png" title="RabbitMQ" alt="RabbitMQ">
</p>




<p class="center">
  <a href="/images/messages_on_rails_part_3/rabbitmq_generalization.png" target="_blank">See in better quality</a>
</p>


<h2>Publishing/Receiving messages and exchanges</h2>

<p>Ability to implement a publish-subscribe pattern is a natural consequence of having exchanges. As we could see on the graph above, the producer is not aware of all of the queues to which the messages will be delivered. It might be even the case that there are no queues at all that would be interested in any message!</p>

<p>For the queues to receive messages, we need to create a relationship between that queue and the exchange. In RabbitMQ it&rsquo;s called a <code>binding</code>.</p>

<p>So far, we know that the publisher sends a message to the exchange and exchange delivers the messages to queues that are bound to it. But what are the rules here that would determine to which queues exactly the message should be delivered to (besides the fact that the queues must have established a binding with the exchange)?</p>

<p>To achieve that, we have four types of exchange types that have a bit different behavior:</p>

<ol>
<li><code>fanout</code> exchange &ndash; it just delivers a message to all the queues that are bound to it.</li>
<li><code>direct</code> &ndash; a given queue might be only interested in some particular type of messages that could be filtered out by some criteria. E.g., you might be publishing logs with different levels, just like in <code>Rails.logger</code> where you have <code>debug</code>, <code>info</code>, <code>fatal</code> etc. severity levels. In that case, there might be a queue that wants to receive only <code>fatal</code> logs, and another one might want to receive just <code>debug</code> logs. Instead of letting the consumer do the filtering itself, we can let RabbitMQ do it by specifying a <code>routing key</code> in the message. We could publish logs with routing keys such as <code>log.debug</code> and <code>log.fatal</code> and let the queues bind accordingly using that routing key as a <code>binding key</code>. That&rsquo;s exactly what a <code>direct</code> exchange is about. However, what if we want to have a third queue that would be interested in all types of logs? In that case, we would need to use another kind of exchange:</li>
<li><code>topic</code> &ndash; it&rsquo;s the exchange that allows receiving messages based on the patterns. In case of the example of logs, the queue that would be interested in all kinds of logs could create a binding with <code>log.*</code> routing key. And what if it were interested in receiving all messages (i.e., work as a <code>fanout</code> exchange, even though we are using <code>topic</code> exchange here)? RabbitMQ has us covered, we could use a special routing key: <code>#</code> and that would be enough. Also, the <code>topic</code> exchange can also act as a <code>direct</code> one &ndash; there is nothing preventing a queue from binding with a full routing key name, so using more &ldquo;advanced&rdquo; exchange type is only adding more options and flexibility, it doesn&rsquo;t take away the features of &ldquo;simpler&rdquo; ones.</li>
<li><code>headers</code> exchange type &ndash; arguably a less common one, it&rsquo;s quite similar to <code>topic</code> exchange, although the filtering is performed based on the values of the headers instead of routing keys.</li>
</ol>


<h2>Using RabbitMQ in Ruby/Rails apps</h2>

<h3>RPC with RabbitMQ</h3>

<p>There is one somewhat unexpected feature of RabbitMQ (at least if you focus on async messaging) &ndash; Remote Procedure Call (RPC). That way you can implement synchronous request-reply flow, just like with HTTP APIs. So if it&rsquo;s just like good ol&#8217; HTTP API, why would you even consider RPCs via RabbitMQ?</p>

<p>Sometimes you might not need REST API as you might be interested only in executing a specific set of commands/procedures in another service that don&rsquo;t easily map to resources that you would expose in REST API. It is especially true if you develop a private API which is not going to be exposed to Third Party Users, so there is little concern for &ldquo;externalization&rdquo;.</p>

<p>Let&rsquo;s check a quick example to see it in action. To make RPC with RabbitMQ what we need to do is to publish a message and specify a reply-to (callback) queue to which the server will reply.</p>

<p>Let&rsquo;s implement a classic: a Fibonacci sequence server to which the clients will be sending the numbers and expecting the result in the response. One of the super simple ways to implement RPCs in Ruby is to do it via <a href="https://github.com/peejaybee/bunny_burrow">bunny_borrow gem</a>. To see it almost right away in action, you could add it to a Gemfile of any Rails application, open two Rails console processes, execute this code in the first one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Fibonacci</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">calculate</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">accum</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">number</span> <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>    <span class="n">accum</span><span class="o">[</span><span class="n">number</span><span class="o">]</span> <span class="o">||=</span> <span class="n">calculate</span><span class="p">(</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">accum</span><span class="p">)</span> <span class="o">+</span> <span class="n">calculate</span><span class="p">(</span><span class="n">number</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">accum</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">rpc_server</span> <span class="o">=</span> <span class="ss">BunnyBurrow</span><span class="p">:</span><span class="ss">:Server</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">server</span><span class="o">|</span>
</span><span class='line'>  <span class="n">server</span><span class="o">.</span><span class="n">rabbitmq_url</span> <span class="o">=</span> <span class="s2">&quot;amqp://guest:guest@localhost:5672&quot;</span>
</span><span class='line'>  <span class="n">server</span><span class="o">.</span><span class="n">rabbitmq_exchange</span> <span class="o">=</span> <span class="s2">&quot;fibonacci_sequence&quot;</span>
</span><span class='line'>  <span class="n">server</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">rpc_server</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;fibonacci.route&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">payload</span><span class="o">|</span>
</span><span class='line'>  <span class="ss">BunnyBurrow</span><span class="p">:</span><span class="ss">:Server</span><span class="o">.</span><span class="n">create_response</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
</span><span class='line'>    <span class="n">response</span><span class="o">[</span><span class="ss">:result</span><span class="o">]</span> <span class="o">=</span> <span class="no">Fibonacci</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">))</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">rpc_server</span><span class="o">.</span><span class="n">wait</span>
</span></code></pre></td></tr></table></div></figure>


<p>and this in the second one:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">rpc_client</span> <span class="o">=</span> <span class="ss">BunnyBurrow</span><span class="p">:</span><span class="ss">:Client</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">client</span><span class="o">|</span>
</span><span class='line'>  <span class="n">client</span><span class="o">.</span><span class="n">rabbitmq_url</span> <span class="o">=</span>  <span class="s2">&quot;amqp://guest:guest@localhost:5672&quot;</span>
</span><span class='line'>  <span class="n">client</span><span class="o">.</span><span class="n">rabbitmq_exchange</span> <span class="o">=</span> <span class="s2">&quot;fibonacci_sequence&quot;</span>
</span><span class='line'>  <span class="n">client</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;number&quot;</span> <span class="o">=&gt;</span> <span class="mi">10</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="n">rpc_client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s2">&quot;fibonacci.route&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">[</span><span class="s2">&quot;result&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Just don&rsquo;t forget to install RabbitMQ before ;).</p>

<p>And that&rsquo;s it! You will see the result of <code>55</code> getting printed. RPC with <code>bunny_borrow</code> merely requires binding to the right exchange, agreeing on the routing key we are going to use and publishing a message!</p>

<h3>Background jobs with Sneakers &ndash; Redis/Sidekiq replacement</h3>

<p>As already mentioned before, RabbitMQ can be a bit like Redis for background processing purposes. And it turns out that we even have a reliable replacement for Sidekiq that is backed by RabbitMQ! We can easily implement workers with <a href="https://github.com/jondot/sneakers">sneakers gem</a>, especially if you use ActiveJob as we have already adapter for Sneakers! But even if you use Sneakers standalone, you shouldn&rsquo;t expect too many surprises there. It looks like a regular worker class. The only difference is that it requires manual acknowledgment of having the message processed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">MySneakersWorker</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Sneakers</span><span class="p">:</span><span class="ss">:Worker</span>
</span><span class='line'>  <span class="n">from_queue</span> <span class="ss">:queue_name</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;From Sneakers: </span><span class="si">#{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ack!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you are curious why you might want to prefer Sneaker over Sidekiq, I would recommend reading the <a href="https://github.com/jondot/sneakers/wiki/Why-i-built-it">docs</a>.</p>

<h3>Event-Driven Applications with Hutch</h3>

<p>The case where RabbitMQ really will shine in our Rails applications is for event-driven architecture or in general, publish-subscribe use cases. It happens quite often in communication between microservices that we don&rsquo;t necessarily need synchronous calls between two or more apps and making it async will improve the efficiency, scalability and also will allow making the apps more independent, coherent and less coupled to each other. For example, if one application is down, we don&rsquo;t need to worry about this as our message will be processed eventually when the app is back. For synchronous flow, that would be very different as we would need to implement error handling and simply be prepared for that kind of scenario. Also, quite often, there is a clear distinction between primary logic behind some use cases and secondary logic.</p>

<p>Consider the following scenario: you have a checkout page in your e-commerce system where a user can enter credit card data and pay for the order. Are all the following &ldquo;features&rdquo; equally important?</p>

<ul>
<li>executing the charge and confirming the order</li>
<li>sending an email notification to the buyer</li>
<li>sending WhatsApp message someone who will be responsible for delivering this order</li>
<li>updating some internal stats about the orders</li>
</ul>


<p>The first one is clearly the critical part of the logic, and the rest looks like some extra aspects that happen after the order is paid. Should they be called from the same place? And how does it go with the Single Responsibility Principle?</p>

<p>Let&rsquo;s visualize this scenario with the following pseudocode:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmByPayment</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">payment</span><span class="p">)</span>
</span><span class='line'>    <span class="n">order</span><span class="o">.</span><span class="n">confirm!</span><span class="p">(</span><span class="n">payment</span><span class="p">)</span>
</span><span class='line'>    <span class="n">send_notification_to_the</span> <span class="n">buyer</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</span><span class='line'>    <span class="n">send_whatsapp_message_for_delivery</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</span><span class='line'>    <span class="n">update_stats_for_orders</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</span><span class='line'>    <span class="n">update_stats_for_payment</span><span class="p">(</span><span class="n">payment</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># private methods go here</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Certainly, this class looks too busy as it is now. And what if we introduced some extra notifications or other aspects? Would we add just another private method? It doesn&rsquo;t sound exactly like something compliant with SRP.</p>

<p>So what options do we have? One way to deal with it is to go with publish-subscribe pattern &ndash; publish some domain event and implement subscribers that would react to this event. It is doable in Rails apps without too much hassle with <a href="https://github.com/krisleech/wisper">wisper</a> gem. Explaining how to use <code>wisper</code> is outside the scope of this article, but to cut a long story short, that&rsquo;s what this service would look like after a rewrite to event-driven architecture:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmByPayment</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Wisper</span><span class="p">:</span><span class="ss">:Publisher</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">payment</span><span class="p">)</span>
</span><span class='line'>    <span class="n">order</span><span class="o">.</span><span class="n">confirm!</span><span class="p">(</span><span class="n">payment</span><span class="p">)</span>
</span><span class='line'>    <span class="n">broadcast</span><span class="p">(</span><span class="ss">:order_confirmed_by_payment</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">as_json</span><span class="p">,</span> <span class="n">payment</span><span class="o">.</span><span class="n">as_json</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="c1"># private methods go here</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Each of the notification could be extracted to a separate class that is subscribed to <code>order_confirmed_by_payment</code> event. And that way, we would get clean and decoupled classes where the logic is easy to extend.</p>

<p>What does it have to do with RabbitMQ though?</p>

<p>In the code we&rsquo;ve just gone through, everything is implemented within the same application. However, this is not really necessary. Sending notifications can be async, and it&rsquo;s not needed to be done from the same application, we could have a separate service for stats, for sending email notifications, for sending WhatsApp messages etc. And for that, we need some simple way how to inform all the applications that they should do something. And that&rsquo;s where we will need RabbitMQ and one of the Ruby &ldquo;frameworks&rdquo; that is built for this kind of use cases.</p>

<h4>Building Example Producer and Consumer With RabbitMQ and Hutch</h4>

<p>We are going to use <a href="https://github.com/gocardless/hutch">hutch</a> gem to publish event <code>order.confirmed_by_payment</code> event so that some consumers (either within the same app or from apps, it doesn&rsquo;t make much difference) can do something upon it.</p>

<p>Hutch itself is quite opinionated, so there is not much left for us to figure out, yet, it&rsquo;s good to keep in mind that it uses <code>topic</code> exchanges.</p>

<p>Let&rsquo;s get back to our <code>Order::ConfirmByPayment</code> and publish a message with Hutch from there:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmByPayment</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">payment</span><span class="p">)</span>
</span><span class='line'>    <span class="n">order</span><span class="o">.</span><span class="n">confirm!</span><span class="p">(</span><span class="n">payment</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">Hutch</span><span class="o">.</span><span class="n">connect</span>
</span><span class='line'>    <span class="ss">Hutch</span><span class="p">:</span><span class="ss">:Config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">:force_publisher_confirms</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">Hutch</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;order.confirmed_by_payment&quot;</span><span class="p">,</span> <span class="ss">payment</span><span class="p">:</span> <span class="n">payment</span><span class="o">.</span><span class="n">as_json</span><span class="p">,</span> <span class="ss">order</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">as_json</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The logic is quite simple: first, we need to connect Hutch. That&rsquo;s probably not the place where it should be executed, some initializer might be a better idea, but it&rsquo;s in this class to keep the example simpler. It&rsquo;s the same thing with <code>force_publisher_confirms</code> option (that should be moved to some initializer as well) which we use here for extra durability and better guarantees as we require the publisher to wait for the confirmation that the message was published. And then, we publish our message with <code>payment</code> and <code>order</code> keys and their serialized projections as values under <code>order.confirmed_by_payment</code> routing key.</p>

<p>To consume the messages that are published by this class, we need some consumer classes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmedByPaymentStatsUpdaterConsumer</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Hutch</span><span class="p">:</span><span class="ss">:Consumer</span>
</span><span class='line'>  <span class="n">consume</span> <span class="s2">&quot;order.confirmed_by_payment&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="n">do_something_with_payment_and_order</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:payment</span><span class="o">]</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmedByPaymentWhatsAppNotifierConsumer</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Hutch</span><span class="p">:</span><span class="ss">:Consumer</span>
</span><span class='line'>  <span class="n">consume</span> <span class="s2">&quot;order.confirmed_by_payment&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="n">do_something_with_payment</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:payment</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmedByPaymentEmailNotifierConsumer</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Hutch</span><span class="p">:</span><span class="ss">:Consumer</span>
</span><span class='line'>  <span class="n">consume</span> <span class="s2">&quot;order.confirmed_by_payment&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="n">do_something_with_order</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s it! What we need to do is to define consumer classes that include <code>Hutch::Consumer</code> module, define the routing key under which we are going to consume messages and implement <code>process</code> method that will deal with the <code>message</code> that we get and do something with its <code>body</code> that contains what we published via publisher.</p>

<p>Optionally, we may want to specify <code>queue_name</code> explicitly, which is by default generated based on the class name. It will work without an explicit declaration for the majority of the cases, but what is going to happen if we have a consumer with the same class name in more than one application? Instead of having a publish-subscribe pattern, we are going to end up with competing consumers as having the same queue names is the way to do in RabbitMQ! In that case, it&rsquo;s worth prefixing queue name with the app&rsquo;s name or something else that would make it unique in your ecosystem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">class</span> <span class="nc">Order</span><span class="o">::</span><span class="no">ConfirmedByPaymentWhatsAppNotifierConsumer</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Hutch</span><span class="p">:</span><span class="ss">:Consumer</span>
</span><span class='line'>  <span class="n">consume</span> <span class="s2">&quot;order.confirmed_by_payment&quot;</span>
</span><span class='line'>  <span class="n">queue_name</span> <span class="s2">&quot;notifs_app_order_confirmed_by_payments_whats_app_notifier&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="n">do_something_with_payment</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:payment</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The last thing to do is to start the worker process that will consume the messages:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">hutch</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should see an output that looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">52</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">hutch</span> <span class="n">booted</span> <span class="n">with</span> <span class="n">pid</span> <span class="mi">84284</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">52</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">found</span> <span class="n">rails</span> <span class="n">project</span> <span class="p">(</span><span class="o">.</span><span class="p">),</span> <span class="n">booting</span> <span class="n">app</span> <span class="k">in</span> <span class="n">development</span> <span class="n">environment</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">connecting</span> <span class="n">to</span> <span class="n">rabbitmq</span> <span class="p">(</span><span class="ss">amqp</span><span class="p">:</span><span class="sr">//</span><span class="n">guest</span><span class="err">@</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">5672</span><span class="o">/</span><span class="p">)</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">connected</span> <span class="n">to</span> <span class="no">RabbitMQ</span> <span class="n">at</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">as</span> <span class="n">guest</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">opening</span> <span class="n">rabbitmq</span> <span class="n">channel</span> <span class="n">with</span> <span class="n">pool</span> <span class="n">size</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">abort</span> <span class="n">on</span> <span class="n">exception</span> <span class="kp">false</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">using</span> <span class="n">topic</span> <span class="n">exchange</span> <span class="s1">&#39;hutch&#39;</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="no">HTTP</span> <span class="no">API</span> <span class="n">use</span> <span class="n">is</span> <span class="n">enabled</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">connecting</span> <span class="n">to</span> <span class="n">rabbitmq</span> <span class="no">HTTP</span> <span class="no">API</span> <span class="p">(</span><span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="n">guest</span><span class="err">@</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">15672</span><span class="o">/</span><span class="p">)</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">tracing</span> <span class="n">is</span> <span class="n">disabled</span>
</span><span class='line'><span class="mi">2019</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">15</span><span class="ss">T19</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">57</span><span class="n">Z</span> <span class="mi">84284</span> <span class="no">INFO</span> <span class="o">--</span> <span class="n">setting</span> <span class="n">up</span> <span class="n">queues</span>
</span></code></pre></td></tr></table></div></figure>


<p>And you can enjoy using RabbitMQ in your apps and having the logic nicely decoupled with a little cost ;)</p>

<h2>Wrapping Up</h2>

<p><strong>RabbitMQ</strong> is an excellent choice if you need <strong>multiple applications</strong> to talk to each other via events instead of HTTP requests/responses and should you ever need <strong>synchronous</strong> calls, you could take advantage of its <strong>RPC</strong> capabilities. It&rsquo;s a mature <strong>message broker</strong> with well-established Ruby gems that will make it simple to introduce it in your Rails apps.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Karol Galanciak</span></span>

      








  


<time datetime="2019-06-23T18:00:00+02:00" pubdate data-updated="true">Jun 23<span>rd</span>, 2019</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/architecture/'>Architecture</a>, <a class='category' href='/blog/categories/messages/'>Messages</a>, <a class='category' href='/blog/categories/microservices/'>Microservices</a>, <a class='category' href='/blog/categories/rest/'>REST</a>, <a class='category' href='/blog/categories/rabbitmq/'>RabbitMQ</a>, <a class='category' href='/blog/categories/rails/'>Rails</a>, <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/soa/'>SOA</a>
  
</span>


    </p>
    <div class="meta top-line">
      <div class="post-subscription">
  <div id="mc_embed_signup">
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">Do you want to take your developer skills to the next level? Subscribe to my newsletter and never miss another blog post!</label>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_62804f1b69c60e0c7966cddd6_7c71fb81df" tabindex="-1" value=""></div>
      <div class="clear">
      <a href="http://eepurl.com/duztq5" target="_blank" id="mc-embedded-subscribe" class="button">Yes, I want to be a better developer!</a>
    </div>
  </div>
</div>

    </div>
    <div class="top-line">
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq/" data-via="Azdaroth" data-counturl="https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </div>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2019/04/07/messages-on-rails-part-2-kafka/" title="Previous Post: Messages on Rails Part 2: Kafka">&laquo; Messages on Rails Part 2: Kafka</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <img class="left" src="/images/me_formal.jpg" title="me:)" alt="Karol Galanciak - photo">
  <p>Hi, my name is Karol Galanciak, I'm a technical polyglot and domain expert in vacation rental industry, taking it to the next level as CTO of <a href="https://www.bookingsync.com">BookingSync</a></p>

  <p>I specialize in building APIs, enterprise integration using message queues and distributed streaming, microservices architecture and working with legacy applications.</p>

  <p id="email-me"></p>
</section>

<script type="text/javascript">
  (function(d, id, lhs, rhs) {
    d.getElementById(id).innerHTML = "You can reach me at <a rel='nofollow' href='mailto:" + lhs + "@" + rhs + "'>" + lhs + "@" + rhs + "</a>";
  })(window.document, 'email-me', 'karol.galanciak', 'gmail.com');
</script>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/06/23/messages-on-rails-part-3-rabbitmq/">Messages on Rails Part 3: RabbitMQ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/07/messages-on-rails-part-2-kafka/">Messages on Rails Part 2: Kafka</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/24/messages-on-rails-part-1-introduction-to-kafka-and-rabbitmq/">Messages on Rails Part 1 - Introduction to Kafka and RabbitMQ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/27/how-to-tell-the-difference-between-a-default-and-provided-value-for-optional-arguments-in-ruby/">How to Tell the Difference Between a Default and a Provided Value for Optional Arguments in Ruby?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/12/16/inheritance-and-define-method-how-to-make-them-work-together/">Inheritance and Define_method - How to Make Them Work Together</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Azdaroth">@Azdaroth</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Azdaroth',
            count: 6,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
   <h1>Twitter</h1>
   <a class="twitter-timeline" href="https://twitter.com/Azdaroth" data-widget-id="357234540634329088">Tweets by @Azdaroth</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Karol Galanciak -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'karolgalanciak';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq/';
        var disqus_url = 'https://karolgalanciak.com/blog/2019/06/23/messages-on-rails-part-3-rabbitmq/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
